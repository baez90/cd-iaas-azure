{
    "variables": {
        "image_name": "hackerthonImage"
    },
    "provisioners": [{
            "type": "shell",
            "inline": [
                "sudo mkdir -p /opt/ca/",
                "sudo useradd -d /nonexistent -M -r -s /bin/false ca",
                "sudo chown -R $(whoami):$(whoami) /opt/ca"]
        }, {
            "type": "file",
            "source": "./dist",
            "destination": "/opt/ca/hackathon"
        },
        {
            "type": "file",
            "source": "./deploy/packer/config/systemd/hackathon.service",
            "destination": "/tmp/hackathon.service"
        },
        {
            "type": "shell",
            "scripts": [
                "./deploy/packer/scripts/setup.sh"
            ]
        }
    ],
    "builders": [{
            "type": "azure-arm",

            "managed_image_resource_group_name": "CD_IaaS",
            "build_resource_group_name": "CD_IaaS",
            "managed_image_name": "{{ user `image_name` }}",

            "os_type": "Linux",
            "image_publisher": "Canonical",
            "image_offer": "UbuntuServer",
            "image_sku": "18.04-LTS",

            "azure_tags": {
                "dept": "ca",
                "task": "Image deployment"
            },

            "vm_size": "Standard_DS2_v2"
        }
    ]
}